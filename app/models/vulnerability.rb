class Vulnerability < ApplicationRecord
  belongs_to :check
  
  after_create :set_feedbacks

  @@weaknesses = {
    1 => "Encryption of data not applied",
    2 => "Various denial of service attacks",
    3 => "Some allow remote code execution",
    4 => "Ability to view data in transit",
    5 => "Frequent vulnerabilities disclosed",
    6 => "Attacker could view internal name space",
    7 => "Can lead to access to drive share access",
    8 => "Easy to misconfigure SNMP",
    9 => "No confidentiality controls for man in middle atatcks",
    10 => "Access to database from external",
    11 => "Local access available to target system",
    12 => "Encryption of data in transit not applied",
  }
  
  @@risks = {
    1 => "Communications infiltration",
    2 => "System or Network failure",
    3 => "Unauthorised access to view data",
    4 => "Unauthorised modification to data",
    5 => "Unauthorised modification of data and system",
    6 => "Unauthorised ability to view data if attacker 'man in the middle'",
  }

  @@recommandations = {
    1 => "Ensure encryption in transit is applied",
    2 => "Employ only if name server service is required",
    3 => "Employ secure access control to this connection",
    4 => "Ensure connection is redirected to encrypted trafic flow",
    5 => "Ensure encryption is applied",
    6 => "Ensure encrypted service is used",
  }

  def set_feedbacks
    if self.port == "20" || "21" || self.service == "telnet"
      self.weakness = @@weaknesses[12]
      self.risk = @@risks[1]
      self.recommandation = @@recommandations[5]
      self.save
    
    elsif self.port == "25" || self.service == "smtp"
      self.weakness = @@weaknesses[1]
      self.risk = @@risks[1]
      self.recommandation = @@recommandations[5]
      self.save
    
    elsif self.port == "53" || self.service == "dns"
      self.weakness = @@weaknesses[2]
      self.risk = @@risks[2]
      self.recommandation = @@recommandations[2]
      self.save

    elsif self.port == "67" || self.service == "dhcp"
      self.weakness = @@weaknesses[3]
      self.risk = @@risks[5]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "80" || self.service == "http"
      self.weakness = @@weaknesses[4]
      self.risk = @@risks[6]
      self.recommandation = @@recommandations[4]
      self.save

    elsif self.port == "135" || self.service == "epmap"
      self.weakness = @@weaknesses[5]
      self.risk = @@risks[5]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "137" || self.service == "netbios name service"
      self.weakness = @@weaknesses[6]
      self.risk = @@risks[3]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "138" || self.service == "netbios datagram service"
      self.weakness = @@weaknesses[7]
      self.risk = @@risks[4]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "139" || self.service == "netbios session service"
      self.weakness = @@weaknesses[7]
      self.risk = @@risks[4]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "161" || self.service == "snmp"
      self.weakness = @@weaknesses[8]
      self.risk = @@risks[5]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "389" || self.service == "ldap"
      self.weakness = @@weaknesses[9]
      self.risk = @@risks[4]
      self.recommandation = @@recommandations[5]
      self.save

    elsif self.port == "445" || self.service == "msds"
      self.weakness = @@weaknesses[7]
      self.risk = @@risks[5]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "548" || self.service == "afp"
      self.weakness = @@weaknesses[7]
      self.risk = @@risks[5]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "1433" || self.service == "sql server"
      self.weakness = @@weaknesses[10]
      self.risk = @@risks[5]
      self.recommandation = @@recommandations[3]
      self.save

    elsif self.port == "3389" || self.service == "windows remote desktop"
      self.weakness = @@weaknesses[11]
      self.risk = @@risks[5]
      self.recommandation = @@recommandations[3]
      self.save

    else
      "No worries :)" 
    end
  end
end
